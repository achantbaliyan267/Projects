<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>University Dashboard</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Flatpickr CSS (date range) -->
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">

  <style>
    /* ===== Variables (match your palette) ===== */
    :root{
      --bg-main:#F6F7FB;
      --surface-card:#FFFFFF;
      --border-color:#E9EEF5;
      --text-heading:#0F172A;
      --text-muted:#6B7280;
      --primary-accent:#6C5CE7;
      --success:#22C55E;
      --danger:#EF4444;
      --info:#3B82F6;
      --neutral-badge-bg:#F3F4F6;
      --amber-soft:#FEF3C7;
      --amber-dark:#D97706;
      --green-soft:#DCFCE7;
      --green-dark:#16A34A;
      --shadow-card: 0 4px 24px rgba(17,24,39,0.06);
      --sidebar-width:260px;
      --radius-lg:20px;
      --radius-base:12px;
      --transition-fast: 180ms ease;
      --transition-base: 240ms ease;
    }

    /* ===== Base ===== */
    html,body{height:100%}
    body{
      font-family:'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background:var(--bg-main);
      color:var(--text-heading);
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      font-size:14px;
    }
    a { text-decoration: none; color: inherit; }

    /* ===== Layout ===== */
    .app {
      display:flex;
      min-height:100vh;
    }

    /* Sidebar */
    .sidebar {
      width:var(--sidebar-width);
      background:var(--surface-card);
      border-right:1px solid var(--border-color);
      padding:20px;
      position:fixed;
      top:0; left:0; bottom:0;
      overflow:auto;
    }
    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      padding-bottom:14px;
      border-bottom:1px solid var(--border-color);
      margin-bottom:18px;
    }
    .brand .logo {
      width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--primary-accent),#A27BFF);
      color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;
      box-shadow:var(--shadow-card);
    }
    .nav-section {
      margin-top:18px;
      font-size:12px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:.6px;
      padding:0 6px 8px;
    }
    .nav-list { list-style:none;padding:0;margin:0; }
    .nav-item { margin-bottom:6px; }
    .nav-link {
      display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:12px;color:var(--text-muted);
      transition:var(--transition-fast);
    }
    .nav-link:hover{ background: rgba(11,13,18,0.04); color: var(--text-heading); }
    .nav-link .icon { width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:inherit; }
    .nav-link.active { background:#0B0D12; color:#fff; }
    .nav-badge { margin-left:auto; background:var(--primary-accent); color:#fff; padding:2px 8px;border-radius:999px;font-size:12px; }

    /* Main content */
    .content {
      margin-left:var(--sidebar-width);
      padding:24px;
      width:100%;
      transition:var(--transition-base);
    }

    /* Top bar */
    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 16px;
      border-radius:28px;
      background: rgba(255,255,255,0.85);
      border:1px solid var(--border-color);
      box-shadow: var(--shadow-card);
      backdrop-filter: blur(8px);
      gap:12px;
      margin-bottom:22px;
    }
    .search {
      position:relative; width:360px;
    }
    .search input {
      width:100%; padding:10px 16px 10px 40px; border-radius:999px; border:1px solid var(--border-color);
      background:var(--bg-main); transition:var(--transition-fast);
    }
    .search .icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted); }
    .top-actions { display:flex; align-items:center; gap:8px; }

    .date-pill {
      padding:8px 14px; border-radius:999px; border:1px solid var(--border-color); background:var(--bg-main);
      display:flex; align-items:center; gap:8px; cursor:pointer; transition:var(--transition-fast);
    }

    .icon-btn { width:44px;height:44px;border-radius:999px; display:inline-flex;align-items:center;justify-content:center; border:none; background:transparent; cursor:pointer; color:var(--text-muted); transition:var(--transition-fast);}
    .icon-btn:hover { background:var(--bg-main); color:var(--text-heading); }

    .avatar {
      width:42px;height:42px;border-radius:999px;background:var(--primary-accent);color:white;display:flex;align-items:center;justify-content:center;font-weight:700;
      box-shadow: 0 6px 18px rgba(108,92,231,0.12);
    }

    /* Cards */
    .card {
      background:var(--surface-card);
      border:1px solid var(--border-color);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-card);
      overflow:hidden;
      transition: transform var(--transition-base), box-shadow var(--transition-base);
    }
    .card:hover { transform:translateY(-6px); box-shadow: 0 10px 40px rgba(17,24,39,0.08); }

    .card-body { padding:20px; }

    /* KPI */
    .kpi-row { display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; margin-bottom:20px; }
    .kpi-card { position:relative; padding:20px; height:120px; overflow:visible; }
    .kpi-icon { position:absolute; right:20px; top:18px; width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:white;background:linear-gradient(135deg,var(--primary-accent),#A27BFF); opacity:0.96; box-shadow: 0 6px 18px rgba(108,92,231,0.12);}
    .kpi-label { color:var(--text-muted); font-size:13px; }
    .kpi-value { font-size:28px; font-weight:800; margin-top:8px; font-variant-numeric:tabular-nums; letter-spacing:-0.4px; }
    .delta { display:inline-flex; gap:8px; align-items:center; padding:6px 10px;border-radius:10px; font-size:12px; margin-top:10px; }
    .delta.up { background: rgba(34,197,94,0.09); color:var(--green-dark); }
    .delta.down { background: rgba(239,68,68,0.08); color:var(--danger); }

    /* Chart card specifics */
    .chart-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .chart-controls { display:flex; gap:8px; align-items:center; }
    .btn-ghost { background:transparent; border:1px solid var(--border-color); border-radius:999px; padding:6px 10px; cursor:pointer }
    .btn-ghost.active { background:var(--primary-accent); color:#fff; border-color:var(--primary-accent); }

    .chart-area { position:relative; padding:8px 8px 12px; height:220px; }

    /* Floating value pill */
    .floating-pill {
      position:absolute; transform:translate(-50%, -100%); padding:8px 12px; border-radius:999px; background:var(--surface-card); border:1px solid var(--border-color);
      box-shadow:0 6px 20px rgba(17,24,39,0.06); font-weight:700; color:var(--text-heading); pointer-events:none;
    }

    /* Map card */
    .map-container { height:250px; background:linear-gradient(180deg,#FBFBFD,#F7F8FB); border-radius:12px; position:relative; padding:18px; }
    .map-dot { position:absolute; width:12px;height:12px;border-radius:999px;border:2px solid var(--surface-card); box-shadow:0 6px 18px rgba(0,0,0,0.06); transform:translate(-50%,-50%); }
    .legend { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
    .legend-item { display:flex; gap:8px; align-items:center; color:var(--text-muted); font-size:14px; }

    /* Table */
    .table-card .card-body { padding:0; }
    .table-top { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; gap:12px; border-bottom:1px solid var(--border-color); }
    .table-top .left { display:flex; gap:12px; align-items:center; }
    .table-wrapper { max-height:420px; overflow:auto; }
    table.data thead th { position: sticky; top:0; background:var(--bg-main); z-index:5; padding:12px 16px; border-bottom:1px solid var(--border-color); }
    table.data tbody tr:nth-child(even) { background: rgba(249,250,251,0.5); }
    .status { padding:6px 10px; border-radius:10px; font-weight:600; font-size:13px; }

    .status.pending { background:var(--amber-soft); color:var(--amber-dark); }
    .status.accepted { background:var(--green-soft); color:var(--green-dark); }
    .status.rejected { background: rgba(254, 202, 202, 0.3); color:var(--danger); }

    /* Skeleton shimmer */
    .skeleton { background:linear-gradient(90deg,#eee #f4f4f4 #eee); background-size:200% 100%; animation:shimmer 1.5s linear infinite; border-radius:8px; }
    @keyframes shimmer { from{ background-position:-200% 0 } to { background-position:200% 0 } }

    /* Fade-in / stagger */
    .fade-in { opacity:0; transform:translateY(8px); animation:appear .45s forwards; }
    .fade-in.delay-1{ animation-delay: 0.08s } .fade-in.delay-2{ animation-delay: 0.16s } .fade-in.delay-3{ animation-delay: 0.24s } .fade-in.delay-4{ animation-delay: 0.32s }
    @keyframes appear { to { opacity:1; transform:translateY(0);} }

    /* Responsive */
    @media (max-width:1200px){
      .content{ margin-left:70px; }
      .sidebar{ width:70px; padding:14px; }
      .nav-section, .brand span, .nav-badge { display:none; }
      .kpi-row { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width:768px){
      .content{ margin-left:0; padding:16px; }
      .topbar{ flex-direction:column; align-items:stretch; gap:12px; }
      .kpi-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">U</div>
        <div>
          <div style="font-weight:700;">UniPilot</div>
          <div style="font-size:12px;color:var(--text-muted)">University Admin</div>
        </div>
      </div>

      <div class="nav-section">Menu</div>
      <ul class="nav-list mb-3">
        <li class="nav-item"><a class="nav-link active" href="#"><span class="icon" data-feather="home"></span><span>Dashboard</span><span class="nav-badge">5</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="bar-chart-2"></span><span>Analytics</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="trending-up"></span><span>Insights</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="bell"></span><span>Updates</span></a></li>
      </ul>

      <div class="nav-section">Academic</div>
      <ul class="nav-list">
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="users"></span><span>Students</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="book-open"></span><span>Courses</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="layers"></span><span>Departments</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="user-check"></span><span>Faculty</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="user-plus"></span><span>Admissions</span></a></li>
      </ul>

      <div class="nav-section">Settings</div>
      <ul class="nav-list">
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="slack"></span><span>Integrations</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="help-circle"></span><span>Help Desk</span></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><span class="icon" data-feather="settings"></span><span>Settings</span></a></li>
      </ul>
    </aside>

    <!-- Content area -->
    <main class="content">
      <!-- Top bar -->
      <div class="topbar">
        <div class="d-flex align-items-center gap-3" style="flex:1">
          <div class="search me-2">
            <span class="icon"><i data-feather="search"></i></span>
            <input id="globalSearch" type="search" placeholder="Search student, course..." class="form-control">
          </div>
          <div class="date-pill" id="dateRange">
            <i data-feather="calendar" style="width:16px;height:16px"></i>
            <span id="dateLabel">Sep 17 - Sep 23</span>
            <i data-feather="chevron-down" style="width:14px;height:14px"></i>
          </div>
        </div>

        <div class="top-actions">
          <button class="icon-btn" data-bs-toggle="tooltip" title="Toggle theme"><i data-feather="moon"></i></button>
          <button class="icon-btn position-relative" data-bs-toggle="tooltip" title="Notifications">
            <i data-feather="bell"></i>
            <span style="position:absolute;top:8px;right:8px;width:8px;height:8px;border-radius:50%;background:var(--danger)"></span>
          </button>
          <button class="icon-btn" data-bs-toggle="tooltip" title="Settings"><i data-feather="settings"></i></button>
          <div class="avatar" data-bs-toggle="dropdown" aria-expanded="false">AL</div>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Sign out</a></li>
          </ul>
        </div>
      </div>

      <!-- KPI Row -->
      <section class="kpi-row mb-3">
        <div class="card kpi-card fade-in delay-1">
          <div class="kpi-icon"><i data-feather="user"></i></div>
          <div class="kpi-label">Total Students</div>
          <div class="kpi-value js-count" data-target="12842">0</div>
          <div class="delta up"><i data-feather="arrow-up-right" style="width:14px;height:14px"></i> 3.2%</div>
          <div class="text-muted" style="font-size:12px;margin-top:8px;">Compared to last month</div>
        </div>
        <div class="card kpi-card fade-in delay-2">
          <div class="kpi-icon" style="background:linear-gradient(135deg,#FF7AB6,#A65CFF)"><i data-feather="user-plus"></i></div>
          <div class="kpi-label">New Admissions</div>
          <div class="kpi-value js-count" data-target="1124">0</div>
          <div class="delta up"><i data-feather="arrow-up-right" style="width:14px;height:14px"></i> 1.1%</div>
          <div class="text-muted" style="font-size:12px;margin-top:8px;">Rolling 30 days</div>
        </div>
        <div class="card kpi-card fade-in delay-3">
          <div class="kpi-icon" style="background:linear-gradient(135deg,#34D399,#10B981)"><i data-feather="award"></i></div>
          <div class="kpi-label">Graduated</div>
          <div class="kpi-value js-count" data-target="842">0</div>
          <div class="delta down"><i data-feather="arrow-down-left" style="width:14px;height:14px"></i> 0.5%</div>
          <div class="text-muted" style="font-size:12px;margin-top:8px;">Last semester</div>
        </div>
        <div class="card kpi-card fade-in delay-4">
          <div class="kpi-icon" style="background:linear-gradient(135deg,#60A5FA,#7C3AED)"><i data-feather="user-check"></i></div>
          <div class="kpi-label">Faculty</div>
          <div class="kpi-value js-count" data-target="432">0</div>
          <div class="delta up"><i data-feather="arrow-up-right" style="width:14px;height:14px"></i> 0.4%</div>
          <div class="text-muted" style="font-size:12px;margin-top:8px;">Active staff</div>
        </div>
      </section>

      <div class="row g-3">
        <!-- Left column: Chart + Recent Table -->
        <div class="col-lg-8">
          <div class="row g-3">
            <!-- Enrollment Analytics -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <div class="chart-header">
                    <div>
                      <div style="font-weight:700">Enrollment Analytics</div>
                      <div class="text-muted" style="font-size:13px;">Weekly new enrollments</div>
                    </div>
                    <div class="chart-controls">
                      <button class="btn-ghost active">This Week</button>
                      <button class="btn-ghost">Last Week</button>
                    </div>
                  </div>

                  <div class="chart-area position-relative">
                    <canvas id="enrollmentChart" style="max-height:220px;"></canvas>
                    <div id="floatingValue" class="floating-pill" style="display:none;"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Applications Table -->
            <div class="col-12">
              <div class="card table-card">
                <div class="table-top">
                  <div class="left">
                    <input id="tableSearch" class="form-control form-control-sm" placeholder="Search applications..." style="width:260px">
                    <select id="sortBy" class="form-select form-select-sm" style="width:170px">
                      <option value="date_desc" selected>Sort: Newest</option>
                      <option value="date_asc">Oldest</option>
                      <option value="status">Status</option>
                      <option value="program">Program</option>
                    </select>
                  </div>
                  <div class="right text-muted">Showing <span id="tableCount">0</span> applications</div>
                </div>

                <div class="table-wrapper">
                  <table class="table data mb-0">
                    <thead>
                      <tr>
                        <th style="width:36px"><input type="checkbox" id="chkAll"></th>
                        <th>Application ID</th>
                        <th>Date</th>
                        <th>Student</th>
                        <th>Program</th>
                        <th>Status</th>
                        <th>Units</th>
                        <th>Fee</th>
                      </tr>
                    </thead>
                    <tbody id="applicationsTbody">
                      <!-- rows injected by JS -->
                    </tbody>
                  </table>
                </div>

                <div class="d-flex justify-content-between align-items-center p-3" style="border-top:1px solid var(--border-color)">
                  <div><small class="text-muted">Rows per page:</small>
                    <select id="perPage" class="form-select form-select-sm d-inline-block" style="width:80px">
                      <option>5</option><option selected>8</option><option>12</option>
                    </select>
                  </div>
                  <nav>
                    <ul id="pagination" class="pagination mb-0"></ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right column: Map & Growth -->
        <div class="col-lg-4">
          <div class="card mb-3">
            <div class="card-body">
              <div style="display:flex;justify-content:space-between;align-items:start">
                <div>
                  <div style="font-weight:700">Students by Country</div>
                  <div class="text-muted" style="font-size:13px">Distribution of top countries</div>
                </div>
                <div class="text-muted" style="font-size:13px">Last 30 days</div>
              </div>

              <div class="map-container mt-3">
                <!-- Decorative dotted map background can be added; simplified absolute dots -->
                <!-- Dots placed approximately; you can reposition -->
                <div class="map-dot" style="left:24%; top:50%; background:var(--primary-accent);" data-tooltip="USA - 35%"></div>
                <div class="map-dot" style="left:40%; top:42%; background:#FF7AB6;" data-tooltip="UK - 28%"></div>
                <div class="map-dot" style="left:70%; top:62%; background:#34D399;" data-tooltip="BD - 24%"></div>
                <div class="map-dot" style="left:80%; top:32%; background:#A8B0FF;" data-tooltip="UAE - 13%"></div>

                <div class="legend">
                  <div class="legend-item"><span style="width:10px;height:10px;border-radius:50%;background:var(--primary-accent);display:inline-block"></span> USA <strong style="margin-left:6px">35%</strong></div>
                  <div class="legend-item"><span style="width:10px;height:10px;border-radius:50%;background:#FF7AB6;display:inline-block"></span> UK <strong style="margin-left:6px">28%</strong></div>
                  <div class="legend-item"><span style="width:10px;height:10px;border-radius:50%;background:#34D399;display:inline-block"></span> BD <strong style="margin-left:6px">24%</strong></div>
                  <div class="legend-item"><span style="width:10px;height:10px;border-radius:50%;background:#A8B0FF;display:inline-block"></span> UAE <strong style="margin-left:6px">13%</strong></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div style="font-weight:700">Quick Actions</div>
              <div class="text-muted" style="font-size:13px;">Tasks & shortcuts</div>

              <div class="d-flex flex-column gap-2 mt-3">
                <button class="btn btn-outline-primary btn-sm">New Admission</button>
                <button class="btn btn-outline-secondary btn-sm">Export Students</button>
                <button class="btn btn-outline-success btn-sm">Approve Applications</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/countup.js@2.0.7/dist/countUp.min.js"></script>

  <script>
    // Replace feather icons
    feather.replace();

    // Tooltips (Bootstrap)
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));

    // Date range picker
    flatpickr("#dateRange", {
      mode: "range",
      dateFormat: "M j, Y",
      onClose: function(selectedDates, dateStr, instance) {
        const label = dateStr || 'Select range';
        document.getElementById('dateLabel').innerText = label;
      }
    });

    // Skeleton simulation then show data
    window.addEventListener('DOMContentLoaded', () => {
      const counts = document.querySelectorAll('.js-count');

      // Start CountUp animations after small delay (simulate data fetch)
      setTimeout(() => {
        counts.forEach(el => {
          const target = parseInt(el.getAttribute('data-target') || '0', 10);
          const c = new CountUp(el, target, {duration: 1.4, separator: ','});
          if (!c.error) c.start();
        });
      }, 420);

      // Draw Enrollment Chart
      drawEnrollmentChart();

      // Populate table
      TableModule.init();

      // map dots tooltip (simple hover title)
      document.querySelectorAll('.map-dot').forEach(dot => {
        dot.addEventListener('mouseenter', () => {
          const t = dot.getAttribute('data-tooltip');
          dot.setAttribute('title', t);
        });
      });

      // Global search (search across the table)
      document.getElementById('globalSearch').addEventListener('input', (e) => {
        TableModule.setFilter(e.target.value);
      });
    });

    // ===== Enrollment Chart (Chart.js) =====
    function drawEnrollmentChart() {
      const ctx = document.getElementById('enrollmentChart').getContext('2d');
      const labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const data = [120, 180, 150, 200, 220, 170, 240];
      const highlightIndex = 6; // Sunday

      const bgColors = data.map((v,i) => i === highlightIndex ? getComputedStyle(document.documentElement).getPropertyValue('--primary-accent') : '#E9EEF5');

      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Enrollments',
            data,
            backgroundColor: bgColors,
            borderRadius: 10,
            barThickness: 28
          }]
        },
        options: {
          maintainAspectRatio: false,
          animation: {
            duration: 700,
            easing: 'easeOutCubic',
            onComplete: function() { positionFloating(); }
          },
          plugins: {
            legend: { display: false },
            tooltip: { enabled: true, backgroundColor: '#fff', titleColor: '#0F172A', bodyColor: '#0F172A', borderColor: '#E9EEF5', borderWidth:1 }
          },
          scales: {
            x: { grid: { display:false }, ticks: { color: '#6B7280' } },
            y: { grid: { color: '#F1F5F9' }, ticks: { color: '#6B7280', beginAtZero:true, stepSize:50 } }
          }
        }
      });

      // floating pill element
      const floating = document.getElementById('floatingValue');
      function positionFloating() {
        try {
          const meta = chart.getDatasetMeta(0);
          const barEl = meta.data[highlightIndex];
          const canvasRect = ctx.canvas.getBoundingClientRect();
          const x = canvasRect.left + barEl.x;
          const y = canvasRect.top + barEl.y;
          // convert to container-relative coordinates
          const container = document.querySelector('.chart-area');
          const containerRect = container.getBoundingClientRect();
          floating.style.left = (x - containerRect.left) + 'px';
          floating.style.top = (y - containerRect.top - 8) + 'px';
          floating.innerText = chart.data.datasets[0].data[highlightIndex];
          floating.style.display = 'inline-flex';
        } catch (err) {
          // ignore
        }
      }
      // reposition on resize
      window.addEventListener('resize', () => setTimeout(positionFloating, 120));
    }

    // ===== Simple Table Module (search, sort, pagination) =====
    const TableModule = (function(){
      // sample data
      const data = [
        {id:'APP-1001', date:'2025-09-21', student:'Aisha Khan', program:'BSc Computer Science', status:'Pending', units:18, fee:'$1200'},
        {id:'APP-1002', date:'2025-09-20', student:'Jon Doe', program:'BA Economics', status:'Accepted', units:20, fee:'$0'},
        {id:'APP-1003', date:'2025-09-19', student:'Maria Gomez', program:'MSc Data Science', status:'Accepted', units:24, fee:'$1500'},
        {id:'APP-1004', date:'2025-09-18', student:'Liam Chen', program:'MBA', status:'Pending', units:12, fee:'$900'},
        {id:'APP-1005', date:'2025-09-17', student:'Olivia Brown', program:'BSc Biology', status:'Rejected', units:16, fee:'$0'},
        {id:'APP-1006', date:'2025-09-15', student:'Noah Wilson', program:'MSc Physics', status:'Accepted', units:22, fee:'$1200'},
        {id:'APP-1007', date:'2025-09-14', student:'Emma Davis', program:'BEng Civil', status:'Pending', units:20, fee:'$800'},
        {id:'APP-1008', date:'2025-09-13', student:'Aiden Patel', program:'BA History', status:'Accepted', units:18, fee:'$0'},
        {id:'APP-1009', date:'2025-09-11', student:'Sophia Liu', program:'BSc Chemistry', status:'Pending', units:16, fee:'$700'},
        {id:'APP-1010', date:'2025-09-09', student:'Mason Lee', program:'PhD Mathematics', status:'Accepted', units:30, fee:'$2500'},
        {id:'APP-1011', date:'2025-09-08', student:'Isabella Garcia', program:'MSc AI', status:'Pending', units:24, fee:'$1400'},
        {id:'APP-1012', date:'2025-09-07', student:'Ethan Martinez', program:'BSc Economics', status:'Rejected', units:18, fee:'$0'}
      ];

      let filtered = [...data];
      let currentPage = 1;
      let perPage = 8;
      const tbody = document.getElementById('applicationsTbody');
      const pagination = document.getElementById('pagination');
      const tableCount = document.getElementById('tableCount');

      function render() {
        const start = (currentPage - 1) * perPage;
        const pageItems = filtered.slice(start, start + perPage);

        tbody.innerHTML = pageItems.map(r => `
          <tr>
            <td><input type="checkbox" class="row-chk"></td>
            <td>${r.id}</td>
            <td>${formatDate(r.date)}</td>
            <td>${r.student}</td>
            <td>${r.program}</td>
            <td><span class="status ${statusClass(r.status)}">${r.status}</span></td>
            <td>${r.units}</td>
            <td>${r.fee}</td>
          </tr>
        `).join('');

        renderPagination();
        tableCount.innerText = filtered.length;
      }

      function statusClass(s){
        return s.toLowerCase() === 'pending' ? 'pending' : (s.toLowerCase() === 'accepted' ? 'accepted' : 'rejected');
      }

      function formatDate(d){
        const dt = new Date(d);
        return dt.toLocaleDateString(undefined, { month:'short', day:'numeric'});
      }

      function renderPagination(){
        const pages = Math.ceil(filtered.length / perPage) || 1;
        let html = '';
        const left = Math.max(1, currentPage - 2);
        const right = Math.min(pages, currentPage + 2);
        if (currentPage > 1) html += `<li class="page-item"><a class="page-link" href="#" data-page="${currentPage-1}">‹</a></li>`;
        for (let p = left; p <= right; p++){
          html += `<li class="page-item ${p===currentPage?'active':''}"><a class="page-link" href="#" data-page="${p}">${p}</a></li>`;
        }
        if (currentPage < pages) html += `<li class="page-item"><a class="page-link" href="#" data-page="${currentPage+1}">›</a></li>`;
        pagination.innerHTML = html;

        // attach click handlers
        pagination.querySelectorAll('[data-page]').forEach(el=>{
          el.addEventListener('click', (e)=>{
            e.preventDefault();
            currentPage = Number(el.getAttribute('data-page'));
            render();
          })
        });
      }

      // filtering & sorting
      function setFilter(q){
        const ql = (q || '').toLowerCase().trim();
        filtered = data.filter(r => {
          return r.id.toLowerCase().includes(ql) ||
                 r.student.toLowerCase().includes(ql) ||
                 r.program.toLowerCase().includes(ql) ||
                 r.status.toLowerCase().includes(ql);
        });
        currentPage = 1;
        render();
      }

      function setSort(mode){
        if (mode === 'date_desc') filtered.sort((a,b)=> new Date(b.date) - new Date(a.date));
        else if (mode === 'date_asc') filtered.sort((a,b)=> new Date(a.date) - new Date(b.date));
        else if (mode === 'status') filtered.sort((a,b)=> a.status.localeCompare(b.status));
        else if (mode === 'program') filtered.sort((a,b)=> a.program.localeCompare(b.program));
        currentPage = 1;
        render();
      }

      function setPerPage(n){
        perPage = Number(n);
        currentPage = 1;
        render();
      }

      // public init
      function init(){
        // defaults
        filtered = [...data];
        currentPage = 1;
        perPage = Number(document.getElementById('perPage').value || 8);
        render();

        // bind UI
        document.getElementById('tableSearch').addEventListener('input', (e)=> setFilter(e.target.value));
        document.getElementById('sortBy').addEventListener('change', (e)=> setSort(e.target.value));
        document.getElementById('perPage').addEventListener('change', (e)=> setPerPage(e.target.value));
        document.getElementById('chkAll').addEventListener('change', (e)=>{
          document.querySelectorAll('.row-chk').forEach(chk => chk.checked = e.target.checked);
        });
      }

      return { init, setFilter };
    })();
  </script>
</body>
</html>